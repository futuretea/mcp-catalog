name: Grafana
shortDescription: 查询指标、日志、追踪，管理仪表板、告警和值班计划
description: |
  一个 Model Context Protocol (MCP) 服务器，提供与 Grafana 的全面集成，实现与可观测性数据、仪表板、告警和事件管理的无缝交互。连接到 Grafana Cloud 或自托管的 Grafana 实例，以查询指标、日志、追踪、性能分析，管理仪表板和告警，并协调值班计划。

  ## 功能特性
  - **可观测性数据查询**：查询 Prometheus 指标、Loki 日志、Tempo 追踪和 Pyroscope 性能分析
  - **仪表板管理**：搜索、查看、创建、更新仪表板，支持完整的 JSONPath 以进行高效修改
  - **告警管理**：管理告警规则、联系点和告警组，具备全面的监控能力
  - **数据源集成**：列出并与所有配置的数据源交互（Prometheus、Loki、Tempo、Pyroscope 等）
  - **事件管理**：创建、跟踪和管理事件，包括时间线活动和演练事件
  - **值班管理**：管理值班计划、班次、用户和团队，以协调事件响应
  - **Sift 调查**：运行自动调查以在日志中查找慢速请求和错误模式
  - **用户与组织管理**：管理团队、用户、文件夹和组织资源
  - **深层链接生成**：生成指向仪表板、面板和 Explore 查询的直接 URL

  ## 连接所需信息

  **必需：**
  - **Grafana URL**：您的 Grafana 实例 URL（例如，Grafana Cloud 使用 https://your-org.grafana.net，或您的自托管实例 URL）

  **认证（选择一种方法）：**
  - **Service Account Token**（推荐）：从 Grafana 的 Administration > Service Accounts 生成服务账户令牌。确保授予令牌必要的权限以执行预期操作。这是生产环境使用的首选认证方法。
  - **Username & Password**（替代）：使用您的 Grafana 用户名和密码进行基本认证。适用于开发或本地实例。

  **可选：**
  - **Organization ID**：为多组织 Grafana 实例指定特定的组织 ID。
metadata:
  categories: 可观测性, 监控, DevOps, 事件管理
icon: https://avatars.githubusercontent.com/u/7195757?s=48&v=4
repoURL: https://github.com/grafana/mcp-grafana

toolPreview:
- name: list_datasources
  description: 列出 Grafana 中所有可用的数据源。在查询之前使用此工具发现 Prometheus、Loki、Tempo、Pyroscope 和其他数据源。
  params:
    type: "可选。按数据源类型过滤（例如 'prometheus'、'loki'、'tempo'、'grafana-pyroscope-datasource'）"
- name: search_dashboards
  description: 通过查询字符串搜索 Grafana 仪表板。返回匹配的仪表板及其标题、UID、文件夹、标签和 URL。
  params:
    query: "搜索仪表板的查询字符串（例如 'kubernetes'、'alerts'）"
- name: get_dashboard_summary
  description: 获取仪表板的紧凑摘要，包括标题、面板数量、面板类型、变量和元数据，无需加载完整的 JSON。适用于仪表板概览。
  params:
    uid: "要获取摘要的仪表板 UID"
- name: get_dashboard_property
  description: 使用 JSONPath 表达式提取特定的仪表板属性以最小化上下文使用。用于有针对性的查询，如面板标题、查询或变量。
  params:
    uid: "仪表板的 UID"
    jsonPath: "JSONPath 表达式（例如 '$.title'、'$.panels[*].title'、'$.panels[0].targets[*].expr'、'$.templating.list'）"
- name: update_dashboard
  description: 使用完整的 JSON 或高效的补丁操作创建或更新仪表板。支持基于 JSONPath 的补丁以进行有针对性的修改。
  params:
    dashboard: "可选。用于创建新仪表板的完整仪表板 JSON"
    uid: "可选。要更新的现有仪表板的 UID（使用补丁操作时需要）"
    operations: "可选。补丁操作数组，包含 'op'（replace/add/remove）、'path'（JSONPath）和 'value' 字段"
    folderUid: "可选。仪表板文件夹的 UID"
    message: "可选。版本历史的提交消息"
    overwrite: "可选。是否覆盖现有仪表板（默认：false）"
- name: query_prometheus
  description: 对 Prometheus 数据源执行 PromQL 查询。支持即时查询（单个时间点）和范围查询（时间段）。
  params:
    datasourceUid: "Prometheus 数据源的 UID"
    expr: "要查询的 PromQL 表达式（例如 'up'、'rate(http_requests_total[5m])'）"
    queryType: "查询类型：'instant' 或 'range'"
    startTime: "开始时间（RFC3339 或相对时间如 'now-1h'）"
    endTime: "可选。结束时间（范围查询时需要）"
    stepSeconds: "可选。时间序列步长（以秒为单位）（范围查询时需要）"
- name: query_loki_logs
  description: 对 Loki 数据源执行 LogQL 查询以检索日志条目或指标值。返回带有时间戳、标签和行的日志。
  params:
    datasourceUid: "Loki 数据源的 UID"
    logql: "LogQL 查询（例如 '{app=\"nginx\"}'、'{app=\"foo\"} |= \"error\"'、'rate({app=\"bar\"}[1m])'）"
    startRfc3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    endRfc3339: "可选。RFC3339 格式的结束时间（默认：现在）"
    limit: "可选。返回的最大日志行数（默认：10，最大：100）"
    direction: "可选。方向：'forward'（最旧优先）或 'backward'（最新优先，默认）"
- name: list_prometheus_metric_names
  description: 从 Prometheus 数据源列出指标名称，支持可选的正则表达式过滤和分页。
  params:
    datasourceUid: "Prometheus 数据源的 UID"
    regex: "可选。用于匹配指标名称的正则表达式"
    limit: "可选。返回的最大结果数"
    page: "可选。分页的页码"
- name: list_prometheus_label_names
  description: 在 Prometheus 数据源中列出标签名称，支持按序列选择器和时间范围进行可选过滤。
  params:
    datasourceUid: "Prometheus 数据源的 UID"
    matches: "可选。用于过滤结果的标签匹配器数组（例如 [{'filters': [{'name': 'job', 'type': '=', 'value': 'api'}]}]）"
    startRfc3339: "可选。过滤结果的开始时间"
    endRfc3339: "可选。过滤结果的结束时间"
    limit: "可选。返回的最大结果数"
- name: list_prometheus_label_values
  description: 在 Prometheus 中获取特定标签名称的值，支持按序列选择器和时间范围进行可选过滤。
  params:
    datasourceUid: "Prometheus 数据源的 UID"
    labelName: "要查询的标签名称（例如 'job'、'instance'、'environment'）"
    matches: "可选。用于过滤结果的选择器数组"
    startRfc3339: "可选。查询的开始时间"
    endRfc3339: "可选。查询的结束时间"
    limit: "可选。返回的最大结果数"
- name: list_loki_label_names
  description: 列出 Loki 数据源和时间段内日志中所有可用的标签名称（键）。
  params:
    datasourceUid: "Loki 数据源的 UID"
    startRfc3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    endRfc3339: "可选。RFC3339 格式的结束时间（默认：现在）"
- name: list_loki_label_values
  description: 检索 Loki 数据源中特定标签名称的所有唯一值。用于发现过滤选项。
  params:
    datasourceUid: "Loki 数据源的 UID"
    labelName: "要检索值的标签名称（例如 'app'、'env'、'pod'）"
    startRfc3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    endRfc3339: "可选。RFC3339 格式的结束时间（默认：现在）"
- name: list_pyroscope_profile_types
  description: 列出 Pyroscope 数据源中所有可用的性能分析类型（例如 CPU、内存、goroutines）。获取性能分析之前需要。
  params:
    data_source_uid: "Pyroscope 数据源的 UID"
    start_rfc_3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    end_rfc_3339: "可选。RFC3339 格式的结束时间（默认：现在）"
- name: fetch_pyroscope_profile
  description: 从 Pyroscope 数据源获取性能分析以进行分析。返回 DOT 格式的性能分析以进行可视化。
  params:
    data_source_uid: "Pyroscope 数据源的 UID"
    profile_type: "来自 list_pyroscope_profile_types 的性能分析类型（例如 'process_cpu:cpu:nanoseconds:cpu:nanoseconds'）"
    matchers: "可选。Prometheus 风格的匹配器进行过滤（例如 '{service_name=\"foo\"}'）"
    start_rfc_3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    end_rfc_3339: "可选。RFC3339 格式的结束时间（默认：现在）"
    max_node_depth: "可选。节点的最大深度（默认：100，使用 -1 表示无限制）"
- name: list_alert_rules
  description: 列出 Grafana 告警规则及其 UID、标题、当前状态（pending、firing、inactive）和标签。支持按标签过滤和分页。
  params:
    label_selectors: "可选。用于按标签过滤的匹配器数组（例如 [{'filters': [{'name': 'severity', 'type': '=', 'value': 'critical'}]}]）"
    limit: "可选。最大结果数（默认：100）"
    page: "可选。分页的页码"
- name: get_alert_rule_by_uid
  description: 检索特定告警规则的完整配置和状态，包括标题、条件、查询、评估设置和标签。
  params:
    uid: "告警规则的 UID"
- name: create_alert_rule
  description: 使用指定的配置创建新的 Grafana 告警规则，包括查询、条件和通知设置。
  params:
    title: "告警规则的标题"
    ruleGroup: "规则组名称"
    folderUID: "将创建规则的文件夹 UID"
    condition: "查询条件标识符（例如 'A'、'B'）"
    data: "查询数据对象数组"
    noDataState: "无数据时的状态：'NoData'、'Alerting' 或 'OK'"
    execErrState: "执行错误时的状态：'NoData'、'Alerting' 或 'OK'"
    for: "告警触发前的持续时间（例如 '5m'）"
    orgID: "组织 ID"
    annotations: "可选。注解的键值对"
    labels: "可选。标签的键值对"
    uid: "可选。告警规则的 UID"
- name: update_alert_rule
  description: 更新现有的 Grafana 告警规则。需要 create_alert_rule 的所有参数以及要更新的规则的 UID。
  params:
    uid: "要更新的告警规则的 UID"
    title: "告警规则的标题"
    ruleGroup: "规则组名称"
    folderUID: "文件夹 UID"
    condition: "查询条件标识符"
    data: "查询数据对象数组"
    noDataState: "无数据时的状态"
    execErrState: "执行错误时的状态"
    for: "告警触发前的持续时间"
    orgID: "组织 ID"
- name: delete_alert_rule
  description: 按 UID 删除 Grafana 告警规则。此操作无法撤销。
  params:
    uid: "要删除的告警规则的 UID"
- name: list_contact_points
  description: 列出 Grafana 通知联系点及其 UID、名称和类型。支持按精确名称匹配过滤。
  params:
    name: "可选。按联系点名称过滤（精确匹配）"
    limit: "可选。最大结果数（默认：100）"
- name: list_incidents
  description: 列出 Grafana 事件，支持按状态过滤和包含演练事件的选项。
  params:
    status: "可选。按状态过滤：'active' 或 'resolved'"
    drill: "可选。是否包含演练事件（默认：false）"
    limit: "可选。返回的最大事件数"
- name: get_incident
  description: 获取特定事件的详细信息，包括标题、状态、严重性、标签、时间戳和元数据。
  params:
    id: "要检索的事件 ID"
- name: create_incident
  description: 创建新的 Grafana 事件。请谨慎使用，因为它可能会通知许多人。应首先与用户确认。
  params:
    title: "事件的标题"
    severity: "严重级别（例如 'critical'、'high'、'medium'、'low'）"
    roomPrefix: "创建事件的房间前缀"
    status: "可选。事件的初始状态"
    labels: "可选。包含 key、label、description、colorHex 字段的标签对象数组"
    attachUrl: "可选。要附加到事件的 URL"
    attachCaption: "可选。附件的标题"
    isDrill: "可选。这是否是演练事件（默认：false）"
- name: add_activity_to_incident
  description: 向事件的时间线添加备注（userNote 活动）。备注正文可以包含 URL，这些 URL 将作为上下文附加。
  params:
    incidentId: "要添加活动的事件 ID"
    body: "活动备注的正文（URL 将被解析并附加）"
    eventTime: "可选。活动发生的时间（默认：当前时间）"
- name: list_oncall_users
  description: 列出 Grafana OnCall 中的用户，包括 ID、用户名、角色和电子邮件等详细信息。可以检索特定用户或按用户名过滤。
  params:
    userId: "可选。按 ID 获取特定用户的详细信息"
    username: "可选。按用户名过滤"
    page: "可选。分页的页码"
- name: list_oncall_schedules
  description: 列出 Grafana OnCall 计划，支持可选的按团队过滤。返回计划 ID、名称、团队 ID、时区和班次 ID。
  params:
    scheduleId: "可选。按 ID 获取特定计划的详细信息"
    teamId: "可选。按团队 ID 过滤计划"
    page: "可选。分页的页码"
- name: get_current_oncall_users
  description: 获取特定计划的当前值班用户列表。
  params:
    scheduleId: "要获取当前值班用户的计划 ID"
- name: list_oncall_teams
  description: 列出 Grafana OnCall 中配置的团队，支持分页。
  params:
    page: "可选。分页的页码"
- name: list_alert_groups
  description: 列出 Grafana OnCall 中的告警组，具有广泛的过滤选项，包括状态、时间范围、标签和标签。
  params:
    id: "可选。按特定告警组 ID 过滤"
    integrationId: "可选。按集成 ID 过滤"
    routeId: "可选。按路由 ID 过滤"
    state: "可选。按状态过滤：'new'、'acknowledged'、'resolved' 或 'silenced'"
    startedAt: "可选。格式为 '{start}_{end}' ISO 8601 的时间范围过滤器（例如 '2025-01-19T00:00:00_2025-01-19T23:59:59'）"
    labels: "可选。格式为 'key:value' 的标签过滤器数组（例如 ['env:prod', 'severity:high']）"
    name: "可选。按告警组名称过滤"
    teamId: "可选。按团队 ID 过滤"
    page: "可选。分页的页码"
- name: find_slow_requests
  description: 搜索 Tempo 数据源中的慢速请求，分析模式并返回结果。适用于性能故障排除。
  params:
    name: "调查的名称"
    labels: "用于限定分析范围的标签（键值对象）"
    start: "可选。调查的开始时间（ISO 8601，默认：30 分钟前）"
    end: "可选。调查的结束时间（ISO 8601，默认：现在）"
- name: find_error_pattern_logs
  description: 搜索 Loki 日志中与历史平均值相比升高的错误模式，识别异常并返回发现的模式。
  params:
    name: "调查的名称"
    labels: "用于限定分析范围的标签（键值对象）"
    start: "可选。调查的开始时间（ISO 8601，默认：30 分钟前）"
    end: "可选。调查的结束时间（ISO 8601，默认：现在）"
- name: list_sift_investigations
  description: 检索 Sift 调查（自动故障排除分析）列表，支持可选的限制。
  params:
    limit: "可选。返回的最大调查数（默认：10）"
- name: get_sift_investigation
  description: 按 UUID 检索特定 Sift 调查的详细信息。
  params:
    id: "调查的 UUID 字符串（例如 '02adab7c-bf5b-45f2-9459-d71a2c29e11b'）"
- name: generate_deeplink
  description: 为 Grafana 资源（如仪表板、面板或 Explore 查询）生成深层链接 URL，支持可选的时间范围。
  params:
    resourceType: "资源类型：'dashboard'、'panel' 或 'explore'"
    dashboardUid: "可选。仪表板 UID（dashboard 和 panel 类型需要）"
    panelId: "可选。面板 ID（panel 类型需要）"
    datasourceUid: "可选。数据源 UID（explore 类型需要）"
    timeRange: "可选。包含 'from' 和 'to' 字段的时间范围对象（例如 {'from': 'now-1h', 'to': 'now'}）"
    queryParams: "可选。额外的查询参数（键值对象）"
- name: list_teams
  description: 通过查询字符串搜索 Grafana 团队。返回匹配的团队及其名称、ID 和 URL。
  params:
    query: "团队的搜索查询（可以为空以获取所有团队）"
- name: list_users_by_org
  description: 列出当前组织中的用户，包括用户 ID、电子邮件、角色和最后上线信息等详细信息。
  params: {}
- name: search_folders
  description: 通过查询字符串搜索 Grafana 文件夹。返回匹配的文件夹及其标题、UID 和 URL。
  params:
    query: "文件夹的搜索查询（可以为空以获取所有文件夹）"
- name: create_folder
  description: 创建新的 Grafana 文件夹以组织仪表板。
  params:
    title: "文件夹的标题"
    uid: "可选。文件夹 UID（如果省略，Grafana 将生成）"
    parentUid: "可选。父文件夹 UID 以创建嵌套文件夹"
- name: get_datasource_by_uid
  description: 检索特定数据源的详细信息，包括名称、类型、URL、访问设置和配置。
  params:
    uid: "数据源的 UID"
- name: get_datasource_by_name
  description: 使用其名称检索特定数据源的详细信息。
  params:
    name: "数据源的名称"
- name: get_dashboard_by_uid
  description: 检索完整的仪表板 JSON，包括所有面板、变量和设置。警告 - 大型仪表板会消耗大量上下文。考虑使用 get_dashboard_summary 或 get_dashboard_property 进行更高效的查询。
  params:
    uid: "仪表板的 UID"
- name: get_dashboard_panel_queries
  description: 从仪表板检索面板查询和信息。返回包含标题、查询和数据源信息的面板数组。
  params:
    uid: "仪表板的 UID"
- name: query_loki_stats
  description: 检索与 LogQL 选择器匹配的日志流的统计信息。返回流、块、条目和字节的计数。仅接受标签选择器（无行过滤器或聚合）。
  params:
    datasourceUid: "Loki 数据源的 UID"
    logql: "仅 LogQL 标签选择器（例如 '{app=\"nginx\", env=\"prod\"}'）- 无行过滤器或聚合"
    startRfc3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    endRfc3339: "可选。RFC3339 格式的结束时间（默认：现在）"
- name: list_pyroscope_label_names
  description: 列出 Pyroscope 数据源中性能分析中所有可用的标签名称（键）。排除带有双下划线的内部标签。
  params:
    data_source_uid: "Pyroscope 数据源的 UID"
    matchers: "可选。Prometheus 风格的匹配器进行过滤（例如 '{service_name=\"foo\"}'）"
    start_rfc_3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    end_rfc_3339: "可选。RFC3339 格式的结束时间（默认：现在）"
- name: list_pyroscope_label_values
  description: 列出 Pyroscope 数据源中性能分析中特定标签名称的所有可用标签值。
  params:
    data_source_uid: "Pyroscope 数据源的 UID"
    name: "要获取值的标签名称"
    matchers: "可选。Prometheus 风格的匹配器进行过滤（例如 '{service_name=\"foo\"}'）"
    start_rfc_3339: "可选。RFC3339 格式的开始时间（默认：1 小时前）"
    end_rfc_3339: "可选。RFC3339 格式的结束时间（默认：现在）"
- name: list_prometheus_metric_metadata
  description: 列出 Prometheus 指标元数据，包括类型、帮助文本和单位。返回有关当前从目标抓取的指标的元数据。注意 - 此端点是实验性的。
  params:
    datasourceUid: "Prometheus 数据源的 UID"
    metric: "可选。要查询元数据的特定指标"
    limit: "可选。返回的最大指标数"
    limitPerMetric: "可选。每个指标返回的最大指标数"
- name: get_alert_group
  description: 按 ID 从 Grafana OnCall 获取特定告警组的详细信息。
  params:
    alertGroupId: "要检索的告警组 ID"
- name: get_oncall_shift
  description: 按 ID 获取特定 OnCall 班次的详细信息。班次代表用户积极值班的时间段。
  params:
    shiftId: "要获取详细信息的班次 ID"
- name: get_sift_analysis
  description: 按 UUID 从 Sift 调查中检索特定分析。
  params:
    investigationId: "调查的 UUID（例如 '02adab7c-bf5b-45f2-9459-d71a2c29e11b'）"
    analysisId: "要检索的特定分析的 UUID"
- name: get_assertions
  description: 获取给定实体的断言摘要，包括其类型、名称、环境、站点、命名空间和时间范围。
  params:
    entityType: "实体类型（例如 'Service'、'Node'、'Pod'）"
    entityName: "实体名称"
    env: "可选。实体的环境"
    site: "可选。实体的站点"
    namespace: "可选。实体的命名空间"
    startTime: "RFC3339 格式的开始时间"
    endTime: "RFC3339 格式的结束时间"

env:
- name: Grafana URL
  key: GRAFANA_URL
  description: 您的 Grafana 实例 URL（例如，Grafana Cloud 使用 https://your-org.grafana.net，或您的自托管实例 URL）
  required: true
  sensitive: false
- name: Grafana Service Account Token
  key: GRAFANA_SERVICE_ACCOUNT_TOKEN
  description: （推荐）用于 API 认证的 Grafana 服务账户令牌。从 Grafana 的 Administration > Service Accounts 生成。需要执行预期操作的适当权限。
  required: false
  sensitive: true
- key: GRAFANA_USERNAME
  name: Grafana Username
  required: false
  sensitive: false
  description: （可选）用于基本认证的 Grafana 用户名。
- key: GRAFANA_PASSWORD
  name: Grafana Password
  required: false
  sensitive: true
  description: （可选）用于基本认证的 Grafana 密码。
- key: GRAFANA_ORG_ID
  name: Grafana Organization ID
  required: false
  sensitive: false
  description: （可选）用于多组织支持的 Grafana 组织 ID。


runtime: containerized
containerizedConfig:
  image: ghcr.io/obot-platform/mcp-images/grafana:latest
  port: 8080
  path: "/mcp"
  args:
  - -t
  - streamable-http
  - --address
  - 0.0.0.0:8080


