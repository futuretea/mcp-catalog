name: BigQuery Toolbox
shortDescription: 执行 SQL 查询并探索 Google BigQuery 数据集，实现安全访问
description: |
  一个 Model Context Protocol (MCP) 服务器，支持与 Google BigQuery 进行安全交互。该服务器促进 AI 应用程序与 BigQuery 数据集之间的通信，通过受控接口实现结构化的数据探索和分析。

  它使用 [BigQuery Toolbox](https://github.com/googleapis/genai-toolbox) 为 BigQuery 提供工具。

  ## 功能特性
  - **数据探索**：对 BigQuery 数据集执行 SQL 查询
  - **安全访问**：使用 Google Cloud 凭证进行身份验证访问
  - **查询执行**：执行具有适当错误处理的 SQL 查询
  - **自定义工具**：支持通过 YAML 进行自定义工具配置

  ## 连接所需信息

  **必需：**
  - **Google Cloud Project ID**：您的 Google Cloud 项目 ID ([如何查找您的项目 ID](https://support.google.com/googleapi/answer/7014113))
  - **Google Application Credentials**：服务账号 JSON 凭证文件

  **可选：**
  - **Tools YAML**：自定义工具配置文件
  - **BigQuery Dataset Name**：BigQuery 数据集名称，用于替换工具中的 ${BIGQUERY_DATASET_NAME} 占位符

  ## 设置 Google Cloud 凭证

  1. **查找您的 Google Cloud Project ID：**
     - 前往 [Google Cloud Console](https://console.cloud.google.com/)
     - 从顶部的项目下拉菜单中选择您的项目
     - 您的 Project ID 显示在项目信息面板中

  2. **创建服务账号并下载凭证：**
     - 前往 [Google Cloud Console](https://console.cloud.google.com/)
     - 导航到 "IAM & Admin" > "Service Accounts"
     - 点击 "Create Service Account"
     - 填写服务账号详情并点击 "Create"
     - 为服务账号授予适当的 BigQuery 权限：
       - `BigQuery Data Viewer`（读取数据）
       - `BigQuery Job User`（运行查询）
       - `BigQuery User`（通用 BigQuery 访问）
     - 点击 "Done" 创建服务账号
     - 点击创建的服务账号
     - 进入 "Keys" 标签页，点击 "Add Key" > "Create new key"
     - 选择 "JSON" 格式并点击 "Create"
     - 凭证文件将下载到您的计算机
     - 配置 MCP 服务器时上传此 JSON 文件

    您也可以使用 gcloud cli 创建：
    ```
    gcloud auth application-default login
    ```

    在浏览器中完成 OAuth 登录后，凭证文件将保存到您的主目录为 `~/.config/gcloud/application_default_credentials.json`。

  3. 您可以提供自定义工具配置 YAML 文件来扩展可用工具。查看 [此处](https://googleapis.github.io/genai-toolbox/samples/bigquery/mcp_quickstart/) 获取示例。

  默认情况下，您可以在工具配置 YAML 文件中使用 ${GOOGLE_CLOUD_PROJECT} 和 ${BIGQUERY_DATASET_NAME} 作为占位符来动态设置项目和数据集名称。

  例如：

  ```yaml

  sources:
    my-bigquery-source:
      kind: bigquery
      project: ${GOOGLE_CLOUD_PROJECT}
      location: us
  tools:
    search-hotels-by-name:
      kind: bigquery-sql
      source: my-bigquery-source
      description: Search for hotels based on name.
      parameters:
        - name: name
          type: string
          description: The name of the hotel.
      statement: SELECT * FROM `${BIGQUERY_DATASET_NAME}.hotels` WHERE LOWER(name) LIKE LOWER(CONCAT('%', @name, '%'));
    search-hotels-by-location:
      kind: bigquery-sql
      source: my-bigquery-source
      description: Search for hotels based on location.
      parameters:
        - name: location
          type: string
          description: The location of the hotel.
      statement: SELECT * FROM `${BIGQUERY_DATASET_NAME}.hotels` WHERE LOWER(location) LIKE LOWER(CONCAT('%', @location, '%'));
    book-hotel:
      kind: bigquery-sql
      source: my-bigquery-source
      description: >-
        Book a hotel by its ID. If the hotel is successfully booked, returns a NULL, raises an error if not.
      parameters:
        - name: hotel_id
          type: integer
          description: The ID of the hotel to book.
      statement: UPDATE `${BIGQUERY_DATASET_NAME}.hotels` SET booked = TRUE WHERE id = @hotel_id;
    update-hotel:
      kind: bigquery-sql
      source: my-bigquery-source
      description: >-
        Update a hotel's check-in and check-out dates by its ID. Returns a message indicating whether the hotel was successfully updated or not.
      parameters:
        - name: checkin_date
          type: string
          description: The new check-in date of the hotel.
        - name: checkout_date
          type: string
          description: The new check-out date of the hotel.
        - name: hotel_id
          type: integer
          description: The ID of the hotel to update.
      statement: >-
        UPDATE `${BIGQUERY_DATASET_NAME}.hotels` SET checkin_date = PARSE_DATE('%Y-%m-%d', @checkin_date), checkout_date = PARSE_DATE('%Y-%m-%d', @checkout_date) WHERE id = @hotel_id;
    cancel-hotel:
      kind: bigquery-sql
      source: my-bigquery-source
      description: Cancel a hotel by its ID.
      parameters:
        - name: hotel_id
          type: integer
          description: The ID of the hotel to cancel.
      statement: UPDATE `${BIGQUERY_DATASET_NAME}.hotels` SET booked = FALSE WHERE id = @hotel_id;
  toolsets:
    my-toolset:
      - search-hotels-by-name
      - search-hotels-by-location
      - book-hotel
      - update-hotel
      - cancel-hotel
  ```

metadata:
  categories: Databases,Data & Analytics
repoURL: https://github.com/obot-platform/bigquery-mcp
icon: https://www.svgrepo.com/show/375551/bigquery.svg
env:
  - key: GOOGLE_CLOUD_PROJECT
    name: Google Cloud Project ID
    required: true
    sensitive: false
    description: 您的 Google Cloud 项目 ID
  - key: GOOGLE_APPLICATION_CREDENTIALS
    name: Google Application Credentials
    required: true
    sensitive: true
    description: 您的服务账号 JSON 凭证文件
    file: true
  - key: BIGQUERY_DATASET_NAME
    name: BigQuery Dataset Name
    required: false
    sensitive: false
    description: BigQuery 数据集名称，用于替换工具中的 ${BIGQUERY_DATASET_NAME} 占位符
  - key: TOOLS_YAML
    name: Tools YAML
    required: false
    sensitive: false
    description: 可选的自定义工具配置 YAML 文件，用于扩展可用工具
    file: true
runtime: containerized
containerizedConfig:
  image: ghcr.io/obot-platform/bigquery-mcp:latest
  port: 5000
  path: /mcp
toolPreview:
  - name: query
    description: |
      对当前项目中的 BigQuery 数据集执行 SQL 查询。
      使用标准 BigQuery SQL 语法。您可以查询项目中的任何数据集。

      使用示例：
      {
          "query": "SELECT * FROM `dataset.table` LIMIT 10"
      }

      query 参数应包含使用 BigQuery 语法的完整 SQL 语句。
      确保在完全限定的表名周围使用反引号，如 `project.dataset.table`。
    params:
      sql: 要执行的 SQL 查询
